import{c as Z,g as I,d as a,u as tt,t as et,r as l,C as at,j as e,R as rt}from"./index-DjgXxVfn.js";import{w as st,a as it}from"./weekday-BfjX8A3v.js";import{c as nt,T as ot}from"./tooltip-BhLTGUFS.js";import{P as lt,a as dt}from"./index-MxTyqqxA.js";import{P as mt}from"./PopUp-WH6JJVy9.js";var R={exports:{}};(function(M,h){(function(S,d){M.exports=d()})(Z,function(){return function(S,d,N){d.prototype.isBetween=function(o,Y,c,v){var j=N(o),y=N(Y),f=(v=v||"()")[0]==="(",b=v[1]===")";return(f?this.isAfter(j,c):!this.isBefore(j,c))&&(b?this.isBefore(y,c):!this.isAfter(y,c))||(f?this.isBefore(j,c):!this.isAfter(j,c))&&(b?this.isAfter(y,c):!this.isBefore(y,c))}}})})(R);var ct=R.exports;const ft=I(ct);a.extend(st);a.extend(it);a.extend(nt);a.extend(ft);a.extend(tt);a.extend(et);const jt=({setDate:M})=>{const[h,S]=l.useState(null),[d,N]=l.useState([]),[o,Y]=l.useState(()=>a().tz("Asia/Kolkata").weekday()!==1?a().tz("Asia/Kolkata").weekday(-6).startOf("day"):a().tz("Asia/Kolkata").weekday(1).startOf("day")),{CalendarData:c,reScheduleCalendar:v,publicHoliday:j}=l.useContext(at),[y]=l.useState(a().format("YYYY-MM-DD|h A|mm")),[f,b]=l.useState({type:null,date:null}),[P,z]=l.useState(!1),[q,K]=l.useState({title:"",date:"",time:null});function L(r,s,i){let m=[],n=a(r);for(;n.isBefore(a(s))||n.isSame(a(s));)m.push(n.format("h A")),n=n.add(i,"minute");return m}const U=a().hour(1).minute(0),V=a().hour(24).minute(0);l.useEffect(()=>{N(L(U,V,60))},[]),l.useEffect(()=>{const r=document.querySelector(".overflow-y-scroll"),s=a(),i=s.minute(),m=Math.floor(i/60)*30,n=s.set("minute",m).format("h A"),w=d==null?void 0:d.findIndex(p=>p===n);r.scrollTop=w*100},[d]);const H=r=>{Y(r==="prev"?a(o).startOf("week").weekday(-6):a(o).startOf("week").weekday(8))};l.useEffect(()=>{M(o)},[o]);const k={};l.useEffect(()=>{const r=o.add(6,"day");let s=[],i=o;for(;i<=r;)s.push({date:i.format("YYYY-MM-DD"),week:i.format("ddd")}),i=i.add(1,"day");S(s)},[o]);const G=(r,s)=>{const{_id:i,date:m,description:n,duration:w,time:p,title:x}=s;K({id:i,date:m,description:n,duration:w,time:p,title:x})};function J(r,s){v(q.id,r,s)}function Q(r){r.preventDefault()}const W=(r,s=null)=>{s?z(s):b({type:"Task",date:a(r).format("YYYY-MM-DD")})};return e.jsxs("div",{className:"flex flex-col justify-stretch flex-1 px-8 pr-4 pt-8 pb-16 h-[800px] ",children:[e.jsxs("div",{className:"flex text-2xl gap-4 justify-end items-center my-4",children:[e.jsxs("h1",{className:"text-lg font-bold",children:[o.format("DD"),"-",o.add(6,"day").format("DD")," ",o.format("MMMM YYYY")]}),e.jsxs("div",{className:"flex gap-10 text-gray-600",children:[e.jsx(lt,{className:"cursor-pointer ",onClick:()=>H("prev")}),e.jsx(dt,{className:"cursor-pointer ",onClick:()=>H("next")})]})]}),e.jsx("div",{className:"overflow-y-scroll overflow-x-hidden",children:e.jsxs("table",{className:"",children:[e.jsx("thead",{className:"border-b-2 sticky top-0 bg-white z-30",children:e.jsxs("tr",{children:[e.jsx("th",{className:"w-20 border-r-2"}),h==null?void 0:h.map((r,s)=>{const i=j.find(n=>n.date.iso===r.date);let m=a().format("YYYY-MM-DD")===r.date;return e.jsx("th",{className:" border-l-2 text-gray-700 py-4",children:e.jsxs("div",{className:"flex flex-col justify-center items-center",children:[e.jsx("p",{className:`text-base font-bold ${m&&"text-[#1967d2]"}`,children:r.week.toUpperCase()}),e.jsx("p",{className:`text-2xl p-2 aspect-square flex justify-center items-center font-bold rounded-full ${m&&"bg-[#1967d2] text-white"}`,children:a(r.date).format("DD")}),i&&e.jsx("div",{className:"w-full relative flex flex-col gap-2 mt-4",children:e.jsx("span",{className:"rounded break-words text-sm mb-1 bg-yellow-300 text-red-500 font-bold",children:i.name})})]})},s)})]})}),e.jsx("tbody",{className:"bg-white",children:d==null?void 0:d.map((r,s)=>{const[i,m,n]=y.split("|");let w=[];return e.jsxs("tr",{className:"relative row-line",children:[e.jsx("td",{className:"absolute top-[-8px] w-20",children:e.jsx("p",{className:"text-xs z-10 ",children:r})}),h==null?void 0:h.map((p,x)=>{let u=!1,$=a(r,"h A").format("HH:mm"),C=a(`${p.date} ${$}`),T=0,g=1;u=c.filter(t=>{let D=a(`${t.date} ${t.time}`);if((D.isSame(C)||D.isBetween(C.subtract(0,"minute"),C.add(60*g,"minute")))&&!w.find(B=>B===t._id))return T+=t.duration,T>60&&(g=Math.ceil(T/60)),w.push(t._id),!0});let A=u.reduce((t,D)=>t+D.duration,0);return g=u.length>0?Math.ceil(A/60):1,!k[x]||k[x]===0?(g>1&&(k[x]=g-1),e.jsx("td",{rowSpan:g,className:`cursor-pointer w-[13.5%] p-[2px] h-28 delay-100 text-white border-l-2 flex-1 relative  rounded-lg  
                          ${!u.length>0&&"hover:bg-[#0997e458] hover:text-white"} ${u.find(t=>t._id!==P)&&"z-[1]"}
                          `,onClick:()=>W(p.date),children:e.jsxs("div",{className:"flex flex-col gap-[0.5px] items-start left-[0px] right-[.4px] absolute top-0 h-[99%] w-[100%]",onDrop:()=>{J(C.format("YYYY-MM-DD"),$)},onDragOver:Q,children:[u.map((t,D)=>{const B={Task:"#f5265a",Meeting:"#33ca2f",Calling:"#5abbf0"},_=a(t.time,"HH:mm").diff(a($,"HH:mm"),"minute")/60*100,F=B[t==null?void 0:t.type]||null;let X=A===t.duration?t.duration/(60*g)*100:t.duration/A*100,O=a(`${t==null?void 0:t.date} ${t==null?void 0:t.time}`);return e.jsxs(rt.Fragment,{children:[e.jsx("div",{style:{height:_?`calc(${_}% `:"0px"}}),e.jsxs("div",{className:"p-2 rounded w-full",draggable:!!t,onDragStart:E=>u&&G(E,t),onClick:E=>{E.stopPropagation(),W(p.date,t==null?void 0:t._id)},style:{backgroundColor:F,height:`calc(${X}%)`},children:[u&&e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-sm font-semibold truncate",children:t==null?void 0:t.title}),e.jsx("p",{className:"text-xs tracking-wide  truncate",children:O&&`${O.format("hh:mm")} - ${O.add(t==null?void 0:t.duration,"minutes").format("hh:mm A")}`})]}),e.jsx(ot,{isVisible:P,setIsVisible:z,found:t,setShowPopUpType:b,color:F,position:x<3?"right":"left"})]})]},D)}),m===r&&p.date===i&&e.jsx("div",{className:"absolute w-[120%] ml-[-15%]",style:{top:`${Math.floor(n/60*100)}%`},children:e.jsx("div",{className:"h-[2px] bg-red-700 relative ",children:e.jsx("div",{className:"w-3 aspect-square rounded-full bg-inherit absolute top-[-5px] "})})})]})},x)):(k[x]-=1,null)})]},s)})})]})}),(f==null?void 0:f.type)&&e.jsx(mt,{showPopUpType:f.type,setShowPopUpType:b,...f})]})};export{jt as default};
